# LLM Experiment Analysis Workflow

This document outlines the two-step process for analyzing the results generated by the `llm_experiment_framework`. The workflow is designed to first isolate final answers from raw model output and then calculate a similarity score against a list of correct answers.

## Workflow Overview

The process uses two main scripts and a structured directory layout:
-   `intermediate/`: Stores the semi-processed data after answer extraction.
-   `results/`: Stores the final analysis output.

The scripts are:
1.  **Extraction Scripts:** Various scripts designed to extract answers based on different heuristics.
    *   `extract_answers.py`: (General purpose)
    *   `extract_answers_stable.py`: (Previous general purpose version, kept for comparison)
    *   `extract_answers_maths.py`: (General math expression extraction with validation)
    *   `extract_answers_integral.py`: (Specialized for integral calculus, uses `+ C` anchor)
2.  `analyse.py`: Reads the cleaned data from the `intermediate/` folder and saves a final analysis to the `results/` folder.

This two-step process, which includes a manual review, ensures that the final analysis is based on high-quality, clean data.

---

### **Step 1: Extract Final Answers**

Choose the appropriate extraction script based on your use case.
The script will automatically append a suffix (e.g., `_integral`, `_maths`) to the `output_file` name defined in `extract_config.py` to keep different extraction results separate.

#### **1. Configure the Extraction**

Open `extract_config.py` and set the values.

```python
# extract_config.py
EXTRACT_CONFIG = {
    # Path to the raw Excel file from the experiment framework.
    "input_file": "../llm_experiment_framework/results/llama_integral_experiment.xlsx",

    # Base name for the output file.
    # The chosen extraction script (e.g., extract_answers_integral.py)
    # will automatically add a suffix (e.g., '_integral') to this.
    "output_file": "llama_integral_experiment_CLEANED.xlsx",
    
    # OPTIONAL: A list of specific sheet names to process.
    # If the list is empty, all sheets will be processed.
    # If you provide names, only those sheets will be processed and updated in the output file.
    "sheets_to_process": []
}
```
-   **`sheets_to_process`**: Use this optional setting to target specific sheets. If you run the script again with a different list of sheets, it will update the *same output file* without deleting the previously processed sheets.

#### **2. Run the Chosen Extraction Script**

From the root `LLM_Phase_Transitions` directory, run the appropriate command:

*   **For general text extraction:**
    ```bash
    python analysis_tool/extract_answers.py
    ```
    (Output file will be named `..._CLEANED.xlsx`)

*   **For comparing with previous stable version:**
    ```bash
    python analysis_tool/extract_answers_stable.py
    ```
    (Output file will be named `..._CLEANED_stable.xlsx`)

*   **For general mathematical expression extraction (with validation):**
    ```bash
    python analysis_tool/extract_answers_maths.py
    ```
    (Output file will be named `..._CLEANED_maths.xlsx`)

*   **For integral calculus expressions (uses `+ C` anchor):**
    ```bash
    python analysis_tool/extract_answers_integral.py
    ```
    (Output file will be named `..._CLEANED_integral.xlsx`)

The script will create or update the specified file in the `analysis_tool/intermediate/` directory.

### **Step 2: Manual Review (Crucial)**

Open the generated `_CLEANED_*.xlsx` file located in the `intermediate/` folder. Review the extracted answers on the sheets you just processed and manually correct any errors.

### **Step 3: Analyze the Cleaned Answers**

#### **1. Configure the Analysis**

Open `analysis_config.py` and set the values.

```python
# analysis_config.py
ANALYSIS_CONFIG = {
    # Path to the CLEANED file, pointing into the `intermediate/` directory.
    # Make sure this matches the output of the extraction script you ran (e.g., `_CLEANED_integral.xlsx`).
    "input_file": "intermediate/llama_integral_experiment_CLEANED_integral.xlsx",

    # A list of all valid or "correct" strings to check against.
    "correct_answers": [
        "1/2*tan(ln(x))^2 + ln(cos(ln(x))) + C"
    ],

    # Name for the final analysis file. It will be saved in the `results/` directory.
    "output_file": "final_analysis_results.xlsx"
}
```
-   `correct_answers`: Provide a Python list of all strings that should be considered correct.

#### **2. Run the Analysis Script**

From the root `LLM_Phase_Transitions` directory, run the following command:

```bash
python analysis_tool/analyse.py
```

This will generate your final results file inside the `analysis_tool/results/` directory.
